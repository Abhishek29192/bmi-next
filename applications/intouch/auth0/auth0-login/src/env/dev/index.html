<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>InTouch Login</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      @font-face {
        font-family: "Effra-Regular";
        font-style: normal;
        font-weight: 400;
        src: url("https://cdn.bmigroup.com/-/media/themes/bmig/global/fonts/effra_w_rg.woff2?rev=9d836de5fcbd491fa6c4604e1e580584")
            format("woff2"),
          url("https://cdn.bmigroup.com/-/media/themes/bmig/global/fonts/effra_w_rg.woff?rev=f6b7de9460094042a133da70f6697634")
            format("woff");
      }

      @font-face {
        font-family: "Effra-Bold";
        font-style: normal;
        font-weight: 700;
        src: url("https://cdn.bmigroup.com/-/media/themes/bmig/global/fonts/effra_w_bd.woff2?rev=7e0aea5910d54cef9feedba05c04793e")
            format("woff2"),
          url("https://cdn.bmigroup.com/-/media/themes/bmig/global/fonts/effra_w_bd.woff?rev=be807579f97149c8985a8438bc87793a")
            format("woff");
      }

      @font-face {
        font-family: "Effra-Heavy";
        font-style: normal;
        font-weight: 900;
        src: url("https://cdn.bmigroup.com/-/media/themes/bmig/global/fonts/effra_w_he.woff2?rev=967101a5f3624dffa2280d70df7bda04")
            format("woff2"),
          url("https://cdn.bmigroup.com/-/media/themes/bmig/global/fonts/effra_w_he.woff?rev=7af3cdaffa0e4af380a79c9666784652")
            format("woff");
      }

      [x-cloak] {
        display: none !important;
      }
    </style>
    <script>
      if (typeof window.queueMicrotask !== "function") {
        window.queueMicrotask = function (callback) {
          Promise.resolve()
            .then(callback)
            .catch((e) =>
              setTimeout(() => {
                throw e;
              })
            );
        };
      }
    </script>
    <script type="module">
      import AlpineI18n from "https://cdn.jsdelivr.net/npm/alpinejs-i18n@2.x.x/dist/module.esm.js";

      document.addEventListener("alpine:init", () => {
        window.Alpine.plugin(AlpineI18n);
      });
    </script>
    <script
      defer="defer"
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script
      defer="defer"
      src="https://storage.googleapis.com/bmi-np-intouch-gcs-publicstorage-euw3-dev/auth0/js/app.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
    />
    <link
      href="https://storage.googleapis.com/bmi-np-intouch-gcs-publicstorage-euw3-dev/auth0/css/app.css"
      rel="stylesheet"
    />
    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
      function OptanonWrapper() {}
    </script>
  </head>
  <body>
    <div id="login-screen" class="login-screen" x-data="body">
      <form onsubmit="return false;" method="post">
        <div class="login-box" x-show="step == 'login'">
          <h1 class="underlined-heading" x-text="$t('signup_welcome')">
            Welcome
          </h1>
          <label class="mdc-text-field mdc-text-field--outlined"
            ><span class="mdc-notched-outline"
              ><span class="mdc-notched-outline__leading"></span>
              <span class="mdc-notched-outline__notch"
                ><span
                  class="mdc-floating-label"
                  id="login-email-label"
                  x-text="$t('enter_email')"
                  >Enter Email</span
                > </span
              ><span class="mdc-notched-outline__trailing"></span> </span
            ><input
              id="login-email"
              type="email"
              class="mdc-text-field__input"
              aria-labelledby="login-email-label"
          /></label>
          <div class="password-container">
            <label class="mdc-text-field mdc-text-field--outlined"
              ><span class="mdc-notched-outline"
                ><span class="mdc-notched-outline__leading"></span>
                <span class="mdc-notched-outline__notch"
                  ><span
                    class="mdc-floating-label"
                    id="login-password-label"
                    x-text="$t('enter_password')"
                    >Enter Password</span
                  > </span
                ><span class="mdc-notched-outline__trailing"></span> </span
              ><input
                id="login-password"
                type="password"
                class="mdc-text-field__input"
                aria-labelledby="login-password-label"
            /></label>
            <div class="forgot-password-box">
              <a
                class="link-button"
                x-text="$t('forgot_password')"
                @click="step = 'forgot_password'"
                >Forgot password?</a
              >
            </div>
          </div>
          <div class="button-container">
            <div class="mdc-touch-target-wrapper">
              <button
                type="submit"
                id="btn-login"
                class="mdc-button mdc-button--unelevated"
              >
                <span class="mdc-button__label" x-text="$t('log_in')"
                  >Log in</span
                >
              </button>
            </div>
            <div class="mdc-touch-target-wrapper">
              <button
                class="mdc-button mdc-button--touch"
                @click="step = 'register'"
              >
                <span class="mdc-button__ripple"></span>
                <span
                  class="mdc-button__label mdc-button__underlined"
                  x-text="$t('not_registered')"
                  >Not registered?</span
                >
                <span class="mdc-button__touch"></span>
              </button>
            </div>
            <div class="mdc-touch-target-wrapper">
              <div id="login-form-error-message" class="error-message"></div>
            </div>
          </div>
        </div>
      </form>
      <form id="signup-form" onsubmit="return false;" method="post">
        <div class="login-box" x-show="step == 'register'" x-cloak>
          <h1 class="underlined-heading" x-text="$t('signup_welcome')">
            Welcome
          </h1>
          <div class="role-container">
            <div class="registration-intro">
              <p x-text="$t('intouch_role')">
                Please select your registration type
              </p>
              <div class="mdc-tooltip-wrapper--rich tooltip-container">
                <div aria-describedby="tt0">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    viewBox="0 0 24 24"
                    width="24px"
                    fill="#007bbd"
                  >
                    <path d="M0 0h24v24H0V0z" fill="none" />
                    <path
                      d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"
                    />
                  </svg>
                </div>
                <div
                  id="tt0"
                  class="mdc-tooltip mdc-tooltip--rich"
                  aria-hidden="true"
                  role="tooltip"
                >
                  <div
                    class="mdc-tooltip__surface mdc-tooltip__surface-animation"
                  >
                    <p
                      class="mdc-tooltip__content"
                      x-text="$t('registration_tooltip')"
                    >
                      Only select Company Account if you are sure that your
                      company is not already registered InTouch. Individual
                      Accounts will get access to training and can become
                      members of registered companies.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="mdc-form-field">
              <div class="mdc-radio">
                <input
                  class="mdc-radio__native-control"
                  type="radio"
                  id="check-installer"
                  name="intouch_role"
                  value="INSTALLER"
                  checked="checked"
                />
                <div class="mdc-radio__background">
                  <div class="mdc-radio__outer-circle"></div>
                  <div class="mdc-radio__inner-circle"></div>
                </div>
                <div class="mdc-radio__ripple"></div>
              </div>
              <label for="check-installer" x-text="$t('installer')"
                >Installer</label
              >
            </div>
            <div class="mdc-form-field">
              <div class="mdc-radio">
                <input
                  class="mdc-radio__native-control"
                  type="radio"
                  id="radio-1"
                  name="intouch_role"
                  value="COMPANY_ADMIN"
                />
                <div class="mdc-radio__background">
                  <div class="mdc-radio__outer-circle"></div>
                  <div class="mdc-radio__inner-circle"></div>
                </div>
                <div class="mdc-radio__ripple"></div>
              </div>
              <label for="radio-1" x-text="$t('company')">Company</label>
            </div>
          </div>
          <label class="mdc-text-field mdc-text-field--outlined"
            ><span class="mdc-notched-outline"
              ><span class="mdc-notched-outline__leading"></span>
              <span class="mdc-notched-outline__notch"
                ><span
                  class="mdc-floating-label"
                  id="signup-firstname-label"
                  x-text="$t('first_name')"
                  >First Name</span
                > </span
              ><span class="mdc-notched-outline__trailing"></span> </span
            ><input
              id="signup-firstname"
              class="mdc-text-field__input"
              aria-labelledby="signup-firstname-label"
              id="signup-firstname"
          /></label>
          <label class="mdc-text-field mdc-text-field--outlined"
            ><span class="mdc-notched-outline"
              ><span class="mdc-notched-outline__leading"></span>
              <span class="mdc-notched-outline__notch"
                ><span
                  class="mdc-floating-label"
                  id="signup-lastname-label"
                  x-text="$t('last_name')"
                  >Last Name</span
                > </span
              ><span class="mdc-notched-outline__trailing"></span> </span
            ><input
              id="signup-lastname"
              class="mdc-text-field__input"
              aria-labelledby="signup-lastname-label"
              id="signup-lastname"
          /></label>
          <label class="mdc-text-field mdc-text-field--outlined"
            ><span class="mdc-notched-outline"
              ><span class="mdc-notched-outline__leading"></span>
              <span class="mdc-notched-outline__notch"
                ><span
                  class="mdc-floating-label"
                  id="signup-email-label"
                  x-text="$t('enter_email')"
                  >Enter Email</span
                > </span
              ><span class="mdc-notched-outline__trailing"></span> </span
            ><input
              id="signup-email"
              type="email"
              class="mdc-text-field__input"
              aria-labelledby="signup-email-label"
              x-bind="trigger"
          /></label>
          <label class="mdc-text-field mdc-text-field--outlined"
            ><span class="mdc-notched-outline"
              ><span class="mdc-notched-outline__leading"></span>
              <span class="mdc-notched-outline__notch"
                ><span
                  class="mdc-floating-label"
                  id="my-label-id"
                  x-text="$t('enter_password')"
                  >Enter Password</span
                > </span
              ><span class="mdc-notched-outline__trailing"></span> </span
            ><input
              id="signup-password"
              type="password"
              class="mdc-text-field__input"
              aria-labelledby="my-label-id"
              id="signup-password"
          /></label>
          <div class="mdc-form-field terms-check">
            <div class="mdc-checkbox">
              <input
                type="checkbox"
                class="mdc-checkbox__native-control"
                id="terms-and-conditions"
              />
              <div class="mdc-checkbox__background">
                <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                  <path
                    class="mdc-checkbox__checkmark-path"
                    fill="none"
                    d="M1.73,12.91 8.1,19.28 22.79,4.59"
                  />
                </svg>
                <div class="mdc-checkbox__mixedmark"></div>
              </div>
              <div class="mdc-checkbox__ripple"></div>
            </div>
            <label for="terms-and-conditions"
              ><span x-text="$t('i_agree_to')">I agree to BMI's</span>
              <a
                id="terms-link"
                href="#"
                target="_blank"
                x-text="$t('terms_and_conditions')"
                >Terms & Conditions</a
              >
              <span x-text="$t('and')">and</span>
              <a
                id="privacy-link"
                href="#"
                target="_blank"
                x-text="$t('privacy_policy')"
                >Privacy Policy</a
              ></label
            >
          </div>
          <div class="button-container">
            <div class="mdc-touch-target-wrapper">
              <button id="btn-signup" class="mdc-button mdc-button--unelevated">
                <span class="mdc-button__label" x-text="$t('sign_up')"
                  >Sign Up</span
                >
              </button>
            </div>
            <div class="mdc-touch-target-wrapper">
              <button
                class="mdc-button mdc-button--touch"
                @click="step = 'login'"
              >
                <span class="mdc-button__ripple"></span>
                <span
                  class="mdc-button__label mdc-button__underlined"
                  x-text="$t('already_registered')"
                  >Already registered?</span
                >
                <span class="mdc-button__touch"></span>
              </button>
            </div>
            <div class="mdc-touch-target-wrapper">
              <div id="form-signup-error-message" class="error-message"></div>
            </div>
          </div>
        </div>
      </form>
      <form onsubmit="return false;" method="post">
        <div class="login-box" x-show="step == 'forgot_password'" x-cloak>
          <h1 class="underlined-heading" x-text="$t('new_password')">
            Request new password
          </h1>
          <p x-text="$t('new_password_text')">
            Please enter your email address and we will send you a link for a
            password reset
          </p>
          <label class="mdc-text-field mdc-text-field--outlined"
            ><span class="mdc-notched-outline"
              ><span class="mdc-notched-outline__leading"></span>
              <span class="mdc-notched-outline__notch"
                ><span
                  class="mdc-floating-label"
                  id="reguest-password-label"
                  x-text="$t('enter_email')"
                  >Enter Email</span
                > </span
              ><span class="mdc-notched-outline__trailing"></span> </span
            ><input
              type="email"
              class="mdc-text-field__input"
              aria-labelledby="reguest-password-label"
              id="email"
          /></label>
          <div class="button-container">
            <div class="mdc-touch-target-wrapper">
              <button
                class="mdc-button mdc-button--unelevated"
                id="btn-reset-password"
              >
                <span class="mdc-button__label" x-text="$t('reset_password')"
                  >Reset password</span
                >
              </button>
            </div>
            <div class="mdc-touch-target-wrapper">
              <button
                class="mdc-button mdc-button--touch"
                @click="step = 'login'"
              >
                <span class="mdc-button__ripple"></span>
                <span
                  class="mdc-button__label mdc-button__underlined"
                  x-text="$t('back_to_login')"
                  >Back to Log In</span
                >
                <span class="mdc-button__touch"></span>
              </button>
            </div>
            <div class="mdc-touch-target-wrapper">
              <div
                id="reset-password-error-message"
                class="error-message"
              ></div>
            </div>
            <div class="mdc-touch-target-wrapper">
              <div
                id="reset-password-success-message"
                class="success-message"
              ></div>
            </div>
          </div>
        </div>
      </form>
      <div class="captcha-container form-group"></div>
      <div id="signup-alert" class="mdc-dialog">
        <div class="mdc-dialog__container">
          <div
            class="mdc-dialog__surface"
            role="alertdialog"
            aria-modal="true"
            aria-labelledby="my-dialog-title"
            aria-describedby="my-dialog-content"
          >
            <div class="mdc-dialog__title">
              <h1 class="underlined-heading" x-text="$t('alertSignupTitle')">
                Already invited?
              </h1>
            </div>
            <div
              class="mdc-dialog__content"
              x-text="$t('alertSignupDescription', {email: signupEmail})"
            >
              An invitation to register was sent to {email} and is still
              pending. Select ‘Cancel’ to find the email and accept the
              invitation or select ‘Confirm’ to decline the invitation and
              register an individual account.
            </div>
            <div class="mdc-dialog__actions">
              <div class="mdc-touch-target-wrapper">
                <button
                  class="mdc-button mdc-button--outlined"
                  id="btn-cancel-signup"
                  data-mdc-dialog-action="close"
                >
                  <span class="mdc-button__label" x-text="$t('cancel')"
                    >Cancel</span
                  >
                </button>
              </div>
              <div class="mdc-touch-target-wrapper">
                <button
                  class="mdc-button mdc-button--unelevated"
                  id="btn-confirm-signup"
                >
                  <span class="mdc-button__label" x-text="$t('confirm')"
                    >Confirm</span
                  >
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="mdc-dialog__scrim"></div>
      </div>
    </div>
    <!--[if IE 8]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/ie8/0.2.5/ie8.js"></script> <!
    [endif]--><!--[if lte IE 9]>
      <script src="https://cdn.auth0.com/js/polyfills/1.0/base64.min.js"></script>
      <script src="https://cdn.auth0.com/js/polyfills/1.0/es5-shim.min.js"></script>
    <![endif]-->
    <script src="https://cdn.auth0.com/js/auth0/9.16.2/auth0.min.js"></script>
    <script src="https://cdn.auth0.com/js/polyfills/1.0/object-assign.min.js"></script>
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script>
      [].forEach.call(
        document.querySelectorAll(".mdc-text-field"),
        function (el) {
          mdc.textField.MDCTextField.attachTo(el);
        }
      );
      const MDCTooltip = mdc.tooltip.MDCTooltip;
      const tooltips = [].map.call(
        document.querySelectorAll(".mdc-tooltip"),
        function (el) {
          return new MDCTooltip(el);
        }
      );
    </script>
    <script>
      const MDCDialog = mdc.dialog.MDCDialog;
      const dialog = new MDCDialog(document.querySelector(".mdc-dialog"));
    </script>
    <script>
      const messages = {
        en: {
          intouch_title: "InTouch - Login/Registration",
          signup_welcome: "Welcome",
          intouch_role: "Please select your registration type",
          installer: "Installer",
          company: "Company",
          first_name: "First Name",
          last_name: "Last Name",
          enter_email: "Email address",
          enter_password: "Password",
          sign_up: "Sign Up",
          already_registered: "Already registered",
          login_welcome: "Welcome",
          log_in: "Log In",
          forgot_password: "Forgot password?",
          not_registered: "Not registered?",
          new_password: "Request new password",
          new_password_text:
            "Please enter your email address and we will send you a link for a password reset",
          reset_password: "Reset Password",
          back_to_login: "Back to Log In",
          reset_password_success: "Check your inbox",
          email_missing: "Please insert your email",
          generic_error:
            "Please check your credential, if the problem persists contact use",
          name_surname_missing: "First and last name missing",
          email_password_missing: "Email and password missing",
          registration_tooltip:
            "Only select Company Account if you are sure that your company is not already registered InTouch.  Individual Accounts will get access to training and can become members of registered companies.",
          i_agree_to: "I agree to BMI's",
          terms_and_conditions: "Terms & Conditions",
          and: "and",
          privacy_policy: "Privacy Policy",
          success: "Success",
          terms_missing: "Please accept terms & condition",
          PasswordStrengthError:
            "Please use a password with at least 8 characters in length and contain at least 3 of the following 4 types of characters: lower case letters (a-z), upper case letters (A-Z), numbers (i.e. 0-9), special characters (e.g. !@#$%^&*)",
          alertSignupTitle: "Already invited?",
          alertSignupDescription: `An invitation to register was sent to {email} and is still pending. Select ‘Cancel’ to find the email and accept the invitation or select ‘Confirm’ to decline the invitation and register an individual account.`,
          cancel: "Cancel",
          confirm: "Confirm"
        },
        no: {
          intouch_title: "InTouch - Logg inn/Registrering",
          signup_welcome: "Velkommen",
          intouch_role: "Velg din registreringstype",
          installer: "Individuelt medlem",
          company: "Bedrift",
          first_name: "Fornavn",
          last_name: "Etternavn",
          enter_email: "Skriv inn e -post",
          enter_password: "Passord",
          sign_up: "Registrere",
          already_registered: "Allerede registrert",
          login_welcome: "Velkommen",
          log_in: "Logg inn",
          forgot_password: "Glemt passord?",
          not_registered: "Ikke registrert?",
          new_password: "Nytt passord",
          new_password_text:
            "Skriv inn e -postadressen din, så sender vi deg en lenke for tilbakestilling av passord",
          reset_password: "Tilbakestill passord",
          back_to_login: "Tilbake til innlogging",
          reset_password_success: "Sjekk innboksen din",
          email_missing: "Sett inn e -posten din",
          generic_error:
            "Kontroller legitimasjonen din, kontakt oss hvis problemet vedvarer",
          name_surname_missing: "For og etternavn mangler",
          email_password_missing: "E-post og passord mangler",
          registration_tooltip:
            "Velg kun firmakonto hvis du er sikker på at firmaet ditt ikke allerede er registrert i InTouch. Individuelle kontoer får tilgang til opplæring og kan bli medlemmer av registrerte selskaper.",
          i_agree_to: "Jeg er enig i BMI",
          terms_and_conditions: "Betingelser og vilkår",
          and: "og",
          privacy_policy: "Personvernerklæring",
          success: "Suksess",
          terms_missing: "Godta vilkår og betingelser",
          PasswordStrengthError:
            "Bruk et passord med minst 8 tegn og innehold minst 3 av følgende 4 typer tegn: små bokstaver (az), store bokstaver (AZ), tall (dvs. 0-9), spesialtegn ( f.eks.@#$%^&*)",
          alertSignupTitle: "Allerede invitert?",
          alertSignupDescription: `En invitasjon til å registrere seg ble sendt til {email} og venter fortsatt. Velg "Avbryt" for å finne e-posten og godta invitasjonen, eller velg "Bekrefte" for å avslå invitasjonen og registrere en individuell konto.`,
          cancel: "Avbryt",
          confirm: "Bekrefte"
        },
        it: {
          intouch_title: "InTouch - Accesso/Registrazione",
          signup_welcome: "Benvenuto",
          intouch_role: "Seleziona il tuo tipo di registrazione",
          installer: "Installatore",
          company: "Azienda",
          first_name: "Nome",
          last_name: "Cognome",
          enter_email: "Indirizzo e-mail",
          enter_password: "Password",
          sign_up: "Iscriviti",
          already_registered: "Già registrato",
          login_welcome: "Benvenuto",
          log_in: "Log In",
          forgot_password: "Hai dimenticato la password?",
          not_registered: "Non sei registrato?",
          new_password: "Richiedi una nuova password",
          new_password_text:
            "Inserisci il tuo indirizzo email e ti invieremo un link per resettare la password",
          reset_password: "Resetta la password",
          back_to_login: "Torna a Log In",
          reset_password_success: "Controlla la tua casella di posta",
          email_missing: "Per favore inserisci la tua email",
          generic_error:
            "Controlla le tue credenziali, se il problema persiste contattaci",
          name_surname_missing: "Nome e cognome mancanti",
          email_password_missing: "Email e password mancanti",
          registration_tooltip:
            "Selezionare account aziendale solo se si è sicuri che l'azienda non è registrata InTouch.  Gli Account individuali avranno accesso alla formazione e possono diventare membri di aziende registrate.",
          i_agree_to: "Accetto i",
          terms_and_conditions: "Termini e Condizioni",
          and: "e",
          privacy_policy: "Politica sulla privacy",
          success: "Successo",
          terms_missing: "Si prega di accettare i termini e le condizioni",
          PasswordStrengthError:
            "Si prega di utilizzare una password di almeno 8 caratteri e che contenga almeno 3 dei seguenti 4 tipi di caratteri: lettere minuscole (a-z), lettere maiuscole (A-Z), numeri (es. 0-9), caratteri speciali (es. !@#$%^&*)",
          alertSignupTitle: "Già invitato?",
          alertSignupDescription: `Un invito a registrarsi è stato inviato a {email} ed è ancora in sospeso. Seleziona "Annulla" per trovare l'e-mail e accettare l'invito oppure seleziona "Conferma" per rifiutare l'invito e registrare un account individuale.`,
          cancel: "Annulla",
          confirm: "Conferma"
        },
        dk: {
          intouch_title: "InTouch - Login / Registrering",
          signup_welcome: "Velkommen",
          intouch_role: "Vælg en profiltype",
          installer: "Individuelt medlem",
          company: "Virksomhedskonto",
          first_name: "Fornavn",
          last_name: "Efternavn",
          enter_email: "E-mail",
          enter_password: "Kodeord",
          sign_up: "Opret profil",
          already_registered: "Allerede registreret",
          login_welcome: "Velkommen",
          log_in: "Log ind",
          forgot_password: "Glemt din adgangskode?",
          not_registered: "Ikke registreret?",
          new_password: "Indstil ny adgangskode",
          new_password_text:
            "Indtast din e-mailadresse, og vi sender dig et link til at nulstille din adgangskode",
          reset_password: "Indstil ny adgangskode",
          back_to_login: "Tilbage til login",
          reset_password_success: "Tjek din e-mail",
          email_missing: "Indsæt din e-mail",
          generic_error:
            "Har du indtastet oplysningerne korrekt? Kontakt os, hvis problemet fortsætter",
          name_surname_missing: "For- og efternavn mangler",
          email_password_missing: "E-mail og adgangskode mangler",
          registration_tooltip:
            "Vælg 'Virksomhedskonto', hvis du er virksomhedsejer eller administrator og ønsker, at din virksomhed skal være medlem af BMI RoofPro.",
          i_agree_to: "Jeg er enig med BMI's",
          terms_and_conditions: "Vilkår og betingelser",
          and: "og",
          privacy_policy: "Databeskyttelseserklæring",
          success: "Succes",
          terms_missing: "Accepter vilkår og betingelser",
          PasswordStrengthError:
            "Brug en adgangskode med mindst 8 tegn og indeholder mindst 3 af følgende 4 typer tegn: små bogstaver (az), store bogstaver (AZ), tal (dvs. 0-9), specialtegn (f.eks. @ # $% ^ & * )",
          alertSignupTitle: "Allerede inviteret?",
          alertSignupDescription: `En invitation til registrering blev sendt til {email} og afventer stadig. Vælg 'Annullér' for at finde e-mailen og acceptere invitationen, eller vælg 'Bekræfte' for at afvise invitationen og registrere en individuel konto.`,
          cancel: "Annullér",
          confirm: "Bekræfte"
        },
        de: {
          intouch_title: "InTouch - Log-in / Registrieren",
          signup_welcome: "Willkommen",
          intouch_role: "Bitte wählen Sie Ihre Registrierungstyp aus",
          installer: "Einzelnutzer",
          company: "Firma",
          first_name: "Vorname",
          last_name: "Nachname",
          enter_email: "E-Mail-Adresse",
          enter_password: "Passwort",
          sign_up: "Anmelden",
          already_registered: "Bereits registriert?",
          login_welcome: "Willkommen",
          log_in: "Log-in",
          forgot_password: "Passwort vergessen?",
          not_registered: "Nicht registriert?",
          new_password: "Fordere ein neues Passwort an",
          new_password_text:
            "Bitte geben Sie Ihre E-Mail-Adresse ein und wir senden Ihnen einen Link zum Zurücksetzen Ihres Passworts.",
          reset_password: "Neues Passwort festlegen",
          back_to_login: "Zurück zur Anmeldung",
          reset_password_success: "Bitte überprüfen Sie Ihr E-Mail",
          email_missing: "Bitte geben Sie Ihre E-Mail-Adresse ein",
          generic_error:
            "Haben Sie die Informationen richtig eingegeben? Kontaktieren Sie uns, wenn das Problem weiterhin besteht.",
          name_surname_missing: "Vor- und Nachname fehlen",
          email_password_missing: "E-Mail und Passwort fehlen",
          registration_tooltip:
            "Bitte wählen Sie firma, um sich und Ihre Firma zu registrieren. Registrieren Sie sich als Einzelnutzer (Sie können dann ggf. eingeladen werden, einem registrier Unternehmen beizutreten).",
          i_agree_to: "Ich stimme dem BMI zu",
          terms_and_conditions: "Nutzungsbedingungen",
          and: "und",
          privacy_policy: "Datenschutzerklärung",
          success: "Erfolg",
          terms_missing: "Bitte akzeptieren Sie die Nutzungsbedingungen",
          PasswordStrengthError:
            "Bitte verwenden Sie ein Passwort mit mindestens 8 Zeichen Länge und enthalten mindestens 3 der folgenden 4 Zeichenarten: Kleinbuchstaben (a-z), Großbuchstaben (A-Z), Zahlen (zB 0-9), Sonderzeichen (zB !@#$%^&*)",
          alertSignupTitle: "Schon eingeladen?",
          alertSignupDescription: `Eine Einladung zur Registrierung wurde an {email} gesendet und steht noch aus. Wählen Sie „Abbrechen“, um die E-Mail zu finden und die Einladung anzunehmen, oder wählen Sie „Bestätigen“, um die Einladung abzulehnen und ein individuelles Konto zu registrieren.`,
          cancel: "Abbrechen",
          confirm: "Bestätigen"
        },
        es: {
          intouch_title: "InTouch - inicio de sesión / registro",
          signup_welcome: "Bienvenido/a",
          intouch_role: "Seleccione su tipo de registro",
          installer: "Cuenta individual",
          company: "Cuenta de empresa",
          first_name: "Nombre",
          last_name: "Apellido",
          enter_email: "Dirección de correo electrónico",
          enter_password: "Contraseña",
          sign_up: "Inscribirse",
          already_registered: "¿Ya está registrado/a?",
          login_welcome: "Bienvenido/a",
          log_in: "Iniciar sesión",
          forgot_password: "¿Olvido la contraseña?",
          not_registered: "¿Ya está registrado/a?",
          new_password: "Cambiar contraseña",
          new_password_text:
            "Ingrese su dirección de correo electrónico y le enviaremos un enlace para restablecer su contraseña",
          reset_password: "Cree una contraseña",
          back_to_login: "Atrás para iniciar sesión",
          reset_password_success: "Consultar su correo electrónico",
          email_missing:
            "Por favor, introduzca su dirección de correo electrónico",
          generic_error:
            "¿Añadió la información correctamente? Por favor contáctenos si el problema persiste",
          name_surname_missing: "Falta nombre y apellido",
          email_password_missing: "Falta el correo electrónico y la contraseña",
          registration_tooltip:
            "Solo seleccione Cuenta de empresa si está seguro de que su empresa aún no está registrada en InTouch. Las cuentas individuales tendrán acceso a la formación y podrán convertirse en miembros de empresas registradas.",
          i_agree_to: "Acepto los",
          terms_and_conditions: "Términos y condiciones de BMI",
          and: "y",
          privacy_policy: "Política de privacidad de BMI",
          success: "Éxito",
          terms_missing: "Por favor acepte los términos y condiciones de BMI",
          PasswordStrengthError:
            "Utilice una contraseña con al menos 8 caracteres de longitud y que contenga al menos 3 de los siguientes 4 tipos de caracteres: letras minúsculas (az), letras mayúsculas (AZ), números (es decir, 0-9), caracteres especiales (p. ej. !@#$%^&*)",
          alertSignupTitle: "¿Ya estás invitado?",
          alertSignupDescription: `Se envió una invitación para registrarse a {email} y aún está pendiente. Seleccione 'Cancelar' para buscar el correo electrónico y aceptar la invitación o seleccione 'Confirmar' para rechazar la invitación y registrar una cuenta individual.`,
          cancel: "Cancelar",
          confirm: "Confirmar"
        },
        pt: {
          intouch_title: "InTouch - login / registro",
          signup_welcome: "Bem-vindo a",
          intouch_role: "Selecione seu tipo de registro",
          installer: "conta individual",
          company: "conta de empresa",
          first_name: "Nome",
          last_name: "Sobrenome",
          enter_email: "endereço de correio eletronico",
          enter_password: "Senha",
          sign_up: "Registro",
          already_registered: "Já registrado?",
          login_welcome: "Bem-vindo a",
          log_in: "Iniciar sessão",
          forgot_password: "Esqueceu a senha?",
          not_registered: "Já registrado?",
          new_password: "Mudar senha",
          new_password_text:
            "Digite seu endereço de correio eletronico e enviaremos um link para redefinir sua senha",
          reset_password: "Crie uma senha",
          back_to_login: "Volte ao iniciar sessão",
          reset_password_success: "Verifique seu correio eletronico",
          email_missing: "Por favor, indique o seu endereço de correio eletronico",
          generic_error: 
            "Você adicionou as informações corretamente? Entre em contato conosco se o problema persistir",
          name_surname_missing: "Falta nome e sobrenome",
          email_password_missing: "Falta o correio eletronico e contrasenha",
          registration_tooltip:
            "Selecione Conta da empresa apenas se tiver certeza de que sua empresa ainda não está registrada no InTouch. Contas individuais terão acesso a formação e poderão se tornar membros de empresas registradas.",
          i_agree_to: "Eu aceito o",
          terms_and_conditions: "Termos e Condições da BMI",
          and: "e",
          privacy_policy: "Política de Privacidade da BMI",
          success: "Sucesso",
          terms_missing: "Por favor, aceite os termos e condições da BMI",
          PasswordStrengthError:
            "Use uma senha que tenha pelo menos 8 caracteres e contenha pelo menos 3 dos 4 tipos de caracteres a seguir: letras minúsculas (az), letras maiúsculas (AZ), números (ou seja, 0-9), caracteres especiais (p eg !@# $%^&*)",
          alertSignupTitle: "Já convidou?",
          alertSignupDescription: `Um convite para se registrar foi enviado para {email} e ainda está pendente. Selecione 'Cancelar' para encontrar o e-mail e aceitar o convite ou selecione 'Confirmar' para recusar o convite e registrar uma conta individual.`,
          cancel: "Cancelar",
          confirm: "Confirmar"
        }
      };

      const getMarket = (config) => {
        let market = location.hash.substr(1) || config.extraParams.market;
        // If we land to intouch.* without the market we set en as default;
        if (market === "intouch") {
          market = "no";
        }

        return market;
      };

      const setupImage = (config) => {
        const market = getMarket(config);

        // Map market / projects status
        var marketsProjectMap = {
          no: true, // project active
          it: true,
          dk: true,
          de: false,
          es: true,
          pt: true,
          en: false // project not active
        };

        // Map projects status / image
        var marketImages = {
          projectActive:
            "https://storage.googleapis.com/bmi-np-intouch-gcs-publicstorage-euw3-dev/auth0/images/bmi_roofpro_intouch.jpg",
          projectNotActive:
            "https://storage.googleapis.com/bmi-np-intouch-gcs-publicstorage-euw3-dev/auth0/images/bmi_non_roofpro_intouch.jpg"
        };

        if (document.getElementsByClassName("login-screen").length) {
          const image = marketsProjectMap[market]
            ? marketImages.projectActive
            : marketImages.projectNotActive;

          document.getElementsByClassName(
            "login-screen"
          )[0].style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url("${image}")`;
        }
      };

      // finally, pass them to AlpineI18n:
      document.addEventListener("alpine-i18n:ready", function () {
        const config = JSON.parse(
          decodeURIComponent(escape(window.atob("@@config@@")))
        );

        window.AlpineI18n.create(getMarket(config), messages);
      });

      window.addEventListener("load", function () {
        Alpine.data("body", () => ({
          step: "login",
          signupEmail: "",
          trigger: {
            ["@change"]() {
              this.signupEmail = document.getElementById("signup-email").value;
            }
          }
        }));
        Alpine.start();

        window.setTimeout(() => {
          document
            .querySelectorAll(".mdc-text-field__input:-webkit-autofill")
            .forEach((el) => {
              const textField = el.parentNode;

              const label = textField.querySelector(".mdc-floating-label");
              if (label) {
                label.classList.add("mdc-floating-label--float-above");
              }
              const outline = textField.querySelector(".mdc-notched-outline");
              outline.classList.add("mdc-notched-outline--notched");

              if (textField.MDCTextField) {
                textField.MDCTextField.foundation_.notchOutline(true);
              }
            });
        }, 300);

        // Fix to avoid label overlap
        document.getElementsByClassName("login-screen")[0].focus();

        const config = JSON.parse(
          decodeURIComponent(escape(window.atob("@@config@@")))
        );

        setupImage(config);

        var leeway = config.internalOptions.leeway;
        if (leeway) {
          var convertedLeeway = parseInt(leeway);

          if (!isNaN(convertedLeeway)) {
            config.internalOptions.leeway = convertedLeeway;
          }
        }

        var params = Object.assign(
          {
            overrides: {
              __tenant: config.auth0Tenant,
              __token_issuer: config.authorizationServer.issuer
            },
            domain: config.auth0Domain,
            clientID: config.clientID,
            redirectUri: config.callbackURL,
            responseType: "code"
          },
          config.internalOptions
        );

        const market = getMarket(config);

        //const { env } = config.extraParams;
        //const prefix = env === "prod" ? market : `${env}-${market}`;

        document.getElementById("terms-link").href =
          "https://dev-{market}.intouch.bmigroup.com/terms".replace(
            "{market}",
            market
          );
        document.getElementById("privacy-link").href =
          "https://dev-{market}.intouch.bmigroup.com/privacy".replace(
            "{market}",
            market
          );

        var webAuth = new auth0.WebAuth(params);
        var databaseConnection = "Username-Password-Authentication";
        var captcha = webAuth.renderCaptcha(
          document.querySelector(".captcha-container")
        );

        function displayError(error, type) {
          captcha.reload();
          var errorMessage = document.getElementById(type + "-error-message");

          if (messages[market] && messages[market][error]) {
            errorMessage.innerHTML = AlpineI18n.t(error);
          } else {
            errorMessage.innerHTML = AlpineI18n.t("generic_error");
          }

          errorMessage.style.display = "block";
        }

        function displaySuccess(message, type) {
          var errorMessage = document.getElementById(type + "-error-message");
          errorMessage.style.display = "none";

          var successMessage = document.getElementById(
            type + "-success-message"
          );

          if (messages[market] && messages[market][message]) {
            successMessage.innerHTML = AlpineI18n.t(message);
          }

          successMessage.style.display = "block";
        }

        function login(e) {
          e.preventDefault();
          var button = this;
          button.disabled = true;
          var username = document.getElementById("login-email").value;
          var password = document.getElementById("login-password").value;

          if (!username || !password) {
            button.disabled = false;
            displayError("email_password_missing", "login-form");
            return;
          }

          webAuth.login(
            {
              realm: databaseConnection,
              username: username,
              password: password,
              captcha: captcha.getValue()
            },
            function (err) {
              button.disabled = false;
              console.log("err", err);
              if (err) displayError(err.name, "login-form");
            }
          );
        }

        const graphqlOptions = {
          type: "POST",
          contentType: "application/x-www-form-urlencoded"
        };

        async function validateSignupUser(email) {
          if (email) {
            try {
              const response = await $.ajax({
                ...graphqlOptions,
                url: "@@base_url@@/api/validate-user".replace(
                  "{market}",
                  market
                ),
                data: { email }
              });
              if (response) {
                return response.data;
              }
            } catch (err) {
              displayError(err.code, "form-signup");
            }
          }
        }

        async function confirmSignup() {
          const email = document.getElementById("signup-email").value;
          if (email) {
            try {
              const response = await $.ajax({
                ...graphqlOptions,
                url: "@@base_url@@/api/confirm-signup".replace(
                  "{market}",
                  market
                ),
                data: { email }
              });
              if (response && response?.data === "ok") {
                signup();
              }
            } catch (err) {
              this.disabled = false;
              displayError(err.code, "form-signup");
            }
          }
        }

        async function signup() {
          // Get the form
          const form = document.querySelectorAll("#signup-form")[0];
          const terms = document.querySelectorAll("#terms-and-conditions")[0];
          const radios = form.elements["intouch_role"];

          if (!document.querySelectorAll("#terms-and-conditions")[0].checked) {
            displayError("terms_missing", "form-signup");
            return;
          }

          var button = this;
          button.disabled = true;
          var email = document.getElementById("signup-email").value;
          var password = document.getElementById("signup-password").value;
          var first_name = document.getElementById("signup-firstname").value;
          var last_name = document.getElementById("signup-lastname").value;

          if (!first_name || !last_name) {
            button.disabled = false;
            displayError("name_surname_missing", "form-signup");
            return;
          }
          try {
            const { data } = await validateSignupUser(email);

            if (data !== true) {
              dialog.open();
              button.disabled = false;
            } else {
              webAuth.redirect.signupAndLogin(
                {
                  connection: databaseConnection,
                  email: email,
                  password: password,
                  captcha: captcha.getValue(),
                  user_metadata: {
                    intouch_role: radios.value,
                    first_name,
                    last_name,
                    market:
                      config.extraParams.market === "intouch"
                        ? "no"
                        : config.extraParams.market
                  }
                },
                function (err) {
                  button.disabled = false;
                  if (err) displayError(err.code, "form-signup");
                }
              );
            }
          } catch (err) {
            button.disabled = false;
            if (err) displayError(err.code, "form-signup");
          }
        }

        function resetPassword(e) {
          e.preventDefault();

          var button = this;
          button.disabled = true;

          var email = document.getElementById("email").value;
          if (!email) {
            button.disabled = false;
            displayError("email_missing", "reset-password");
            return;
          }
          webAuth.changePassword(
            {
              connection: databaseConnection,
              email: email
            },
            function (err, resp) {
              button.disabled = false;
              if (err) {
                displayError(error.name, "reset-password");
              } else {
                displaySuccess("reset_password_success", "reset-password");
              }
            }
          );
        }

        document.getElementById("btn-login").addEventListener("click", login);
        document.getElementById("btn-signup").addEventListener("click", signup);
        document
          .getElementById("btn-confirm-signup")
          .addEventListener("click", confirmSignup);
        document
          .getElementById("btn-reset-password")
          .addEventListener("click", resetPassword);

        // Define map of OneTrust tokens depends on market.
        const marketsOneTrustMap = {
          no: "6a79505b-511c-4865-a79a-6d6152ba223b-test",
          it: "2194ed0e-b5ed-4ae8-b642-53ff110a08d3-test",
          dk: "7b88b89f-d776-49b4-8cd3-aabbc1f84ba2-test",
          de: "1810f8b2-1df6-424e-98c2-5215b272935e-test",
          es: "eeaf5ed2-4c02-4b0f-ba27-680f7520f30b-test",
          pt: "",
          en: "",
        };

        // Define head element from document.
        let head = document.head;
        if (marketsOneTrustMap[market]) {
          const oneTrustToken = marketsOneTrustMap[market];

          // Create Consent Script for OneTrust.
          let oneTrustConsentScript = document.createElement("script");
          oneTrustConsentScript.setAttribute(
            "src",
            `https://cdn.cookielaw.org/consent/${oneTrustToken}/OtAutoBlock.js`
          );
          head.insertBefore(oneTrustConsentScript, head.lastElementChild);

          // Create Templates Script for OneTrust.
          let oneTrustTemplatesScript = document.createElement("script");
          oneTrustTemplatesScript.setAttribute(
            "src",
            "https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"
          );
          oneTrustTemplatesScript.setAttribute("charSet", "UTF-8");
          oneTrustTemplatesScript.setAttribute(
            "data-domain-script",
            oneTrustToken
          );
          head.insertBefore(oneTrustTemplatesScript, head.lastElementChild);
        } else {
          console.log("OneTrust configuration Error.");
        }
      });
    </script>
    <div id="tooltip-id" class="mdc-tooltip" role="tooltip" aria-hidden="true">
      <div class="mdc-tooltip__surface mdc-tooltip__surface-animation">
        lorem ipsum dolor
      </div>
    </div>
  </body>
</html>
