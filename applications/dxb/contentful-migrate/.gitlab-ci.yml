test_contentful_migrate:
  extends: .test_yarn_workspace
  variables:
    ROOT_DIR: "applications/dxb/contentful-migrate"
    WORKSPACE: "@bmi/dxb-contentful-migrate"

build_contentful_migrate:
  extends: .build_yarn_workspace
  rules:
    - !reference [ .run_for_changes_on_main, rules ]
    - !reference [ .run_for_changes_on_mr, rules ]
    - if: "$CI_COMMIT_TAG"
  variables:
    ROOT_DIR: "applications/dxb/contentful-migrate"
    WORKSPACE: "@bmi/dxb-contentful-migrate"
  artifacts:
    untracked: false
    paths:
      - applications/dxb/contentful-migrate/dist

###############################################################################
# Templates used by each market to run content migrations and trigger a build
# afterwards, to ensure there is a build after the migration has been complete
#
# For example:
# variables:
#   DXB_MARKET_ID: NO
#   ROOT_DIR: applications/dxb/contentful-migrate
###############################################################################
.migrate_content:
  stage: pre deploy
  rules:
    - !reference [.run_for_changes_on_main, rules]
    - if: "$CI_COMMIT_TAG"
  needs:
    - job: install_yarn
      optional: true
    - build_contentful_migrate
  variables:
    DXB_MARKET_ID: "" # Two letter market ID  -i.e. NO
    ROOT_DIR: "applications/dxb/contentful-migrate"
  script:
    - |
      apt-get update
      apt-get install -y jq

      export DELETE_OLD_ENVIRONMENTS=false

      if [ "$CI_COMMIT_BRANCH" == "master" ]; then
        DXB_MIGRATION_CREDENTIALS=$DXB_MIGRATION_CREDENTIALS_QA
      fi

      if [[ "$CI_COMMIT_TAG" =~ $DXB_RELEASE_TAG_FORMAT_PREPROD ]]; then
        export CONTENTFUL_ENVIRONMENT=master
        export CONTENTFUL_ALIAS=pre-production
        export DELETE_OLD_ENVIRONMENTS=true
        export DXB_MIGRATION_CREDENTIALS=$DXB_MIGRATION_CREDENTIALS_PREPROD
        export NEW_ENVIRONMENT_NAME=$CI_COMMIT_TAG
      fi

      if [[ "$CI_COMMIT_TAG" =~ $DXB_RELEASE_TAG_FORMAT_PROD ]]; then
        export CONTENTFUL_ENVIRONMENT=master
        export DELETE_OLD_ENVIRONMENTS=true
        export DXB_MIGRATION_CREDENTIALS=$DXB_MIGRATION_CREDENTIALS_PROD
        export NEW_ENVIRONMENT_NAME=$CI_COMMIT_TAG
      fi

      export MANAGEMENT_ACCESS_TOKEN=$(cat $DXB_MIGRATION_CREDENTIALS | jq -r --arg DXB_MARKET_ID "$DXB_MARKET_ID" '. [$DXB_MARKET_ID] | .MANAGEMENT_ACCESS_TOKEN')
      export SPACE_ID=$(cat $DXB_MIGRATION_CREDENTIALS | jq -r --arg DXB_MARKET_ID "$DXB_MARKET_ID" '. [$DXB_MARKET_ID] | .SPACE_ID')

      yarn workspace @bmi/dxb-contentful-migrate prod

.deploy_gatsby_cloud:
  stage: deploy
  rules:
    - !reference [.run_for_changes_on_main, rules]
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "" # Market ID (as specified in GitLab CI Vars) - i.e. NO/FR/GROUP
    ROOT_DIR: "applications/dxb/contentful-migrate"
  cache: {}
  script:
    - |
      apt-get update
      apt-get install -y jq

      if [[ "$CI_COMMIT_TAG" =~ $DXB_RELEASE_TAG_FORMAT_PREPROD ]]; then
        DXB_BUILD_HOOKS=$DXB_BUILD_HOOKS_PREPROD
      fi

      if [[ "$CI_COMMIT_TAG" =~ $DXB_RELEASE_TAG_FORMAT_PROD ]]; then
        DXB_BUILD_HOOKS=$DXB_BUILD_HOOKS_PROD
      fi

      DXB_MARKET_BUILD_HOOK=$(cat $DXB_BUILD_HOOKS | jq -r --arg DXB_MARKET_ID "$DXB_MARKET_ID" '. [$DXB_MARKET_ID]')
      curl -X POST -d {} $DXB_MARKET_BUILD_HOOK

############################################################################
# Templates used by each consolidated market to run microcopy update
#
# For example:
# variables:
#   DXB_MARKET_ID: NO
############################################################################
.update_mc:
  stage: pre deploy
  variables:
    DXB_MARKET_ID: "" # Market ID - i.e. NO
    IS_CONSOLIDATED: "false" # not consolidated
  needs:
    - job: install_yarn
      optional: true
  rules:
    - if: !reference [ .run_for_preprod_release, rules, if ]
      changes:
        - applications/dxb/contentful-migrate/src/**/*
        - applications/dxb/head/src/constants/microCopies.ts
      variables:
        CONTENTFUL_ENVIRONMENT: pre-production
        DXB_MIGRATION_CREDENTIALS: $DXB_MIGRATION_CREDENTIALS_PREPROD
    - if: !reference [ .run_for_prod_release, rules, if ]
      changes:
        - applications/dxb/contentful-migrate/src/**/*
        - applications/dxb/head/src/constants/microCopies.ts
      variables:
        CONTENTFUL_ENVIRONMENT: master
        DXB_MIGRATION_CREDENTIALS: $DXB_MIGRATION_CREDENTIALS_PROD
  script:
    - |
      apt-get update && apt-get install -y jq
      export MANAGEMENT_ACCESS_TOKEN=$(echo $DXB_MIGRATION_CREDENTIALS | jq -r --arg DXB_MARKET_ID "$DXB_MARKET_ID" '. [$DXB_MARKET_ID] | .MANAGEMENT_ACCESS_TOKEN')
      export SPACE_ID=$(echo $DXB_MIGRATION_CREDENTIALS | jq -r --arg DXB_MARKET_ID "$DXB_MARKET_ID" '. [$DXB_MARKET_ID] | .SPACE_ID')
      cd applications/dxb/contentful-migrate && yarn build && yarn dxb-update-mc:publish --isConsolidated=$IS_CONSOLIDATED

##############################################################
# Market specific migration, microcopy and deploy jobs start from here
##############################################################

migrate_content_qa:
  extends: .migrate_content
  rules:
    - !reference [.run_for_changes_on_main, rules]
  variables:
    CONTENTFUL_ENVIRONMENT: staging
    DXB_MARKET_ID: "NO"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_qa:
  extends: .deploy_gatsby_cloud
  rules:
    - !reference [.run_for_changes_on_main, rules]
  needs:
    - migrate_content_qa
  variables:
    DXB_BUILD_HOOKS: $DXB_BUILD_HOOKS_QA
    DXB_MARKET_ID: "NO"
    ROOT_DIR: "applications/dxb/contentful-migrate"
  before_script:
    # Until https://gitlab.com/gitlab-org/gitlab/-/issues/29407 is resolved
    - temporary_file=$(mktemp)
    - echo ${DXB_BUILD_HOOKS} > $temporary_file
    - DXB_BUILD_HOOKS=$temporary_file

migrate_content_one_page_qa:
  extends: .migrate_content
  rules:
    - !reference [.run_for_changes_on_main, rules]
  variables:
    CONTENTFUL_ENVIRONMENT: one-page-qa
    DXB_MARKET_ID: "NO"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_one_page_qa:
  extends: .deploy_gatsby_cloud
  rules:
    - !reference [.run_for_changes_on_main, rules]
  needs:
    - migrate_content_one_page_qa
  variables:
    DXB_BUILD_HOOKS: $DXB_BUILD_HOOKS_ONE_PAGE_QA
    DXB_MARKET_ID: "NO"
    ROOT_DIR: "applications/dxb/contentful-migrate"
  before_script:
    # Until https://gitlab.com/gitlab-org/gitlab/-/issues/29407 is resolved
    - temporary_file=$(mktemp)
    - echo ${DXB_BUILD_HOOKS} > $temporary_file
    - DXB_BUILD_HOOKS=$temporary_file

migrate_content_norway:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "NO"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_norway:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_norway
  variables:
    DXB_MARKET_ID: "NO"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_italy:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "IT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_italy:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_italy
  variables:
    DXB_MARKET_ID: "IT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_finland:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "FI"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_finland:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_finland
  variables:
    DXB_MARKET_ID: "FI"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_france:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "FR"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_france:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_france
  variables:
    DXB_MARKET_ID: "FR"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_germany:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "DE"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_germany:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_germany
  variables:
    DXB_MARKET_ID: "DE"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_austria:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "AT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_austria:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_austria
  variables:
    DXB_MARKET_ID: "AT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_netherlands:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "NL"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_netherlands:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_netherlands
  variables:
    DXB_MARKET_ID: "NL"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_unitedkingdom:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "UK"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_unitedkingdom:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_unitedkingdom
  variables:
    DXB_MARKET_ID: "UK"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_southafrica:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "ZA"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_southafrica:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_southafrica
  variables:
    DXB_MARKET_ID: "ZA"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_turkey:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "TR"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_turkey:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_turkey
  variables:
    DXB_MARKET_ID: "TR"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_spain:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "ES"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_spain:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_spain
  variables:
    DXB_MARKET_ID: "ES"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_portugal:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "PT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_portugal:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_portugal
  variables:
    DXB_MARKET_ID: "PT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_malaysia:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "MY"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_malaysia:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_malaysia
  variables:
    DXB_MARKET_ID: "MY"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_belgium_nl:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "BE"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_belgium_nl:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_belgium_nl
  variables:
    DXB_MARKET_ID: "BE"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_romania:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "RO"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_romania:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_romania
  variables:
    DXB_MARKET_ID: "RO"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_indonesia:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "ID"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_indonesia:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_indonesia
  variables:
    DXB_MARKET_ID: "ID"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_poland:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "PL"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_poland:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_poland
  variables:
    DXB_MARKET_ID: "PL"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_switzerland_de:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "CH"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_switzerland_de:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_switzerland_de
  variables:
    DXB_MARKET_ID: "CH"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_china_zh:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "CN"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_china_zh:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_china_zh
  variables:
    DXB_MARKET_ID: "CN"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_hungary:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "HU"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_hungary:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_hungary
  variables:
    DXB_MARKET_ID: "HU"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_slovakia:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "SK"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_slovakia:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_slovakia
  variables:
    DXB_MARKET_ID: "SK"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_czechia:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "CZ"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_czechia:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_czechia
  variables:
    DXB_MARKET_ID: "CZ"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_group:
  extends: .migrate_content
  rules:
    - if: "$CI_COMMIT_TAG"
  variables:
    DXB_MARKET_ID: "GROUP"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_group:
  extends: .deploy_gatsby_cloud
  rules:
    - if: "$CI_COMMIT_TAG"
  needs:
    - migrate_content_group
  variables:
    DXB_MARKET_ID: "GROUP"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_sandpit:
  extends: .migrate_content
  rules:
    # Only trigger for PROD tags
    # Gitlab CI/CD does not currently support pattern matching using a regex in
    # a variable. see https://gitlab.com/gitlab-org/gitlab/-/issues/35438
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'
  variables:
    DXB_MARKET_ID: "SANDPIT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_sandpit:
  extends: .deploy_gatsby_cloud
  rules:
    # Only trigger for PROD tags
    # Gitlab CI/CD does not currently support pattern matching using a regex in
    # a variable. see https://gitlab.com/gitlab-org/gitlab/-/issues/35438
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'
  needs:
    - migrate_content_sandpit
  variables:
    DXB_MARKET_ID: "SANDPIT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

migrate_content_blueprint:
  extends: .migrate_content
  rules:
    # Only trigger for PROD tags
    # Gitlab CI/CD does not currently support pattern matching using a regex in
    # a variable. see https://gitlab.com/gitlab-org/gitlab/-/issues/35438
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'
  variables:
    DXB_MARKET_ID: "BLUEPRINT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

deploy_gatsby_cloud_blueprint:
  extends: .deploy_gatsby_cloud
  rules:
    # Only trigger for PROD tags
    # Gitlab CI/CD does not currently support pattern matching using a regex in
    # a variable. see https://gitlab.com/gitlab-org/gitlab/-/issues/35438
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'
  needs:
    - migrate_content_blueprint
  variables:
    DXB_MARKET_ID: "BLUEPRINT"
    ROOT_DIR: "applications/dxb/contentful-migrate"

update_mc_poc:
  extends: .update_mc
  rules:
    - if: !reference [ .run_for_changes_on_main, rules, if ]
      changes:
        - applications/dxb/contentful-migrate/src/**/*
        - applications/dxb/head/src/constants/microCopies.ts
      variables:
        CONTENTFUL_ENVIRONMENT: master
        DXB_MIGRATION_CREDENTIALS: $DXB_MIGRATION_CREDENTIALS_QA
  variables:
    DXB_MARKET_ID: "POC"
    IS_CONSOLIDATED: "true"

update_mc_qa:
  extends: .update_mc
  rules:
    - if: !reference [ .run_for_changes_on_main, rules, if ]
      changes:
        - applications/dxb/contentful-migrate/src/**/*
        - applications/dxb/head/src/constants/microCopies.ts
      variables:
        CONTENTFUL_ENVIRONMENT: staging
        DXB_MIGRATION_CREDENTIALS: $DXB_MIGRATION_CREDENTIALS_QA
  variables:
    DXB_MARKET_ID: "NO"

update_mc_norway:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "NO"

update_mc_italy:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "IT"

update_mc_finland:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "FI"

update_mc_france:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "FR"

update_mc_germany:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "DE"

update_mc_austria:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "AT"

update_mc_netherlands:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "NL"

update_mc_unitedkingdom:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "UK"

update_mc_southafrica:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "ZA"

update_mc_turkey:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "TR"

update_mc_spain:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "ES"

update_mc_portugal:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "PT"

update_mc_malaysia:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "MY"

update_mc_belgium_nl:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "BE"

update_mc_romania:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "RO"

update_mc_indonesia:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "ID"

update_mc_poland:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "PL"

update_mc_switzerland_de:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "CH"

update_mc_china_zh:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "CN"

update_mc_hungary:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "HU"

update_mc_slovakia:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "SK"

update_mc_czechia:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "CZ"

update_mc_group:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "GROUP"

update_mc_sandpit:
  extends: .update_mc
  variables:
    DXB_MARKET_ID: "SANDPIT"
  rules:
    # Only trigger for PROD tags
    # Gitlab CI/CD does not currently support pattern matching using a regex in
    # a variable. see https://gitlab.com/gitlab-org/gitlab/-/issues/35438
    - if: !reference [ .run_for_prod_release, rules, if ]

update_mc_blueprint:
  extends: .update_mc
  rules:
    # Only trigger for PROD tags
    # Gitlab CI/CD does not currently support pattern matching using a regex in
    # a variable. see https://gitlab.com/gitlab-org/gitlab/-/issues/35438
    - if: !reference [ .run_for_prod_release, rules, if ]
  variables:
    DXB_MARKET_ID: "BLUEPRINT"
