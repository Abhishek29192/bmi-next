image: node:10

stages:
  - install
  - build
  - check
  # - deploy

# This folder is cached between builds
# http://docs.gitlab.com/ce/ci/yaml/README.html#cache
cache:
  paths:
    - node_modules/
    # Enables git-lab CI caching. Both .cache and public must be cached, otherwise builds will fail.
    - .cache/
    - public/

install:
  stage: install
  script:
    - yarn install
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    untracked: true
  artifacts:
    untracked: true
    expire_in: 30 mins

build:
  stage: build
  script:
    - yarn run build-head
  artifacts:
    paths:
      - public


coverage_jest:
  stage: check
  script:
    - yarn && yarn run coverage:jest
  dependencies:
    - install
  artifacts:
    paths:
      - coverage

coverage_ts:
  stage: check
  script:
    - yarn run coverage:ts
  dependencies:
    - install
  artifacts:
    paths:
      - coverage-ts
