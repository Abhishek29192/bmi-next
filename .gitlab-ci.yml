image: node:10

stages:
  - install
  - build
  - check
  # - deploy

install:
  stage: install
  script:
    - yarn install
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    untracked: true
  artifacts:
    untracked: true
    expire_in: 30 mins

build:
  stage: build
  script:
    - yarn run build:head
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
      - applications/head/node_modules/
      - applications/head/.cache/
      - applications/head/public/

coverage_jest:
  stage: check
  script:
    - yarn && yarn run coverage:jest
  dependencies:
    - install
  artifacts:
    paths:
      - coverage

coverage_ts:
  stage: check
  script:
    - yarn run coverage:ts
  dependencies:
    - install
  artifacts:
    paths:
      - coverage-ts
