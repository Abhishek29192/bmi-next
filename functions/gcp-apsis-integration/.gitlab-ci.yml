image: node:12

test_gcp_apsis_integration:
  stage: test
  rules:
    - if: "$CI_COMMIT_TAG || $CI_MERGE_REQUEST_ID || $CI_COMMIT_BRANCH == 'master'"
      changes:
        - functions/gcp-apsis-integration/**
        - jest/**
  needs: [install]
  before_script:
    - yarn config set cache-folder ~/.yarn
  script:
    - yarn workspace @bmi/gcp-apsis-integration coverage:jest
  interruptible: true

build_gcp_apsis_integration:
  stage: build
  rules:
    - if: "$CI_COMMIT_TAG || $CI_MERGE_REQUEST_ID || $CI_COMMIT_BRANCH == 'master'"
      changes:
        - functions/gcp-apsis-integration/**
  needs: [install]
  before_script:
    - yarn config set cache-folder ~/.yarn
  script:
    - yarn workspace @bmi/gcp-apsis-integration build
  interruptible: true
